#set document(
  title: "بروتوكول ZELDHASH",
  author: "Ouziel Slama"
)
#set page(
  paper: "a4",
  margin: (x: 2.5cm, y: 2.5cm),
  numbering: "1",
)
#set par(justify: true, leading: 0.65em)
#set heading(numbering: "1.1")
#show heading: it => [
  #it
  #v(0.8em)
]

#align(center)[
  #text(size: 24pt, weight: "bold")[بروتوكول ZELDHASH]
]
#align(center)[
  #text(size: 14pt)[*اصطد أندر معاملات البيتكوين واكسب ZELD.*]
]
#align(center)[
  #text(size: 12pt)[بقلم Ouziel Slama]
]

#v(2em)

= الدوافع

- من أجل إثارة الصيد. كل معاملة تصبح فرصة لاكتشاف شيء نادر — كنز رقمي مخفي على مرأى من الجميع على البلوكتشين.

- أنماط الأصفار البادئة هذه ليست نادرة فحسب — بل يمكنها أيضًا تعزيز الضغط، مما قد يبسط تخزين البلوكتشين وكفاءة المعالجة.

- يمكن لأي شخص كسب ZELD من خلال صيد المعاملات النادرة — لا يوجد فائز واحد لكل كتلة كما في تعدين كتل البيتكوين. الصيد مفتوح للجميع.

- إذا نجح الأمر، يمكن لرموز ZELD في النهاية تعويض رسوم المعاملات — مكافأة الصيادين الذين يكشفون عن أندر الاكتشافات!

= تعدين ZELD

لتعدين ZELD، يجب عليك بث معاملة بيتكوين يبدأ معرف المعاملة (txid) الخاص بها بـ 6 أصفار على الأقل. يتم حساب المكافأة بناءً على كيفية مقارنة معاملتك بأفضل معاملة في الكتلة:

- في كتلة معينة، المعاملات التي تبدأ بأكبر عدد من الأصفار تكسب 4096 ZELD

- المعاملات التي تحتوي على صفر واحد أقل من أفضل المعاملات تكسب 4096/16 أو 256 ZELD

- المعاملات التي تحتوي على صفرين أقل تكسب 4096 / 16 / 16 أو 16 ZELD

- إلخ.

لذلك فإن الصيغة المستخدمة هي كالتالي:

#align(center)[
  ```
  reward = 4096 / 16 ^ (max_zero_count - zero_count)
  ```
]

حيث `max_zero_count` يساوي عدد الأصفار التي تبدأ أفضل معاملة و `zero_count` هو عدد الأصفار التي تبدأ المعاملة التي نحسب مكافأتها.

*ملاحظة:* معاملات Coinbase غير مؤهلة لمكافآت ZELD.

= توزيع ZELD

يتم توزيع ZELD المكتسبة من معاملة تبدأ بـ 6 أصفار أو أكثر على UTXOs. يتم التوزيع على النحو التالي:

- إذا كان هناك UTXO واحد غير OP_RETURN، فإنه يتلقى المكافأة بالكامل.

- إذا كان هناك اثنان أو أكثر من UTXOs غير OP_RETURN، يتم توزيع المكافأة على جميع UTXOs، باستثناء الأخير، بما يتناسب مع قيمة كل UTXO

- نظرًا لأن الحسابات تتم فقط بالأعداد الصحيحة، يتم توزيع الباقي المحتمل من القسمة على أول UTXO غير OP_RETURN.

على سبيل المثال، إذا كانت معاملة تكسب 256 ZELD تحتوي على 4 مخرجات بـ 500 و 500 و 500 و 2000 ساتوشي على التوالي، فإن المخرج الأول يتلقى 86 ZELD من المكافأة، والثاني والثالث 85 ZELD.

= نقل ZELD

عندما يتم إنفاق UTXOs مع ZELD مرفقة، يتم توزيع ZELD على UTXOs الجديدة في المعاملة. هناك طريقتان لتوزيع ZELD عند نقلها:

== الطريقة 1: التوزيع النسبي التلقائي

افتراضيًا، يتم التوزيع بنفس الطريقة تمامًا مثل المكافآت — بشكل نسبي بناءً على قيم البيتكوين لـ UTXOs المخرجة، باستثناء المخرج الأخير إذا كان هناك مخرجات متعددة.

== الطريقة 2: التوزيع المخصص عبر OP_RETURN

يمكنك تحديد كيفية توزيع ZELD بالضبط من خلال تضمين مخرج OP_RETURN في معاملتك مع بيانات توزيع مخصصة. هذا يسمح بالتحكم الدقيق في تحويلات ZELD.

=== تنسيق OP_RETURN:

- يجب أن يحتوي سكريبت OP_RETURN على بيانات تبدأ ببادئة 4 بايت "ZELD"

- بعد البادئة، يجب ترميز البيانات بتنسيق CBOR

- يجب أن تمثل بيانات CBOR متجهًا من الأعداد الصحيحة غير الموقعة 64 بت (Vec<u64>)

- يحدد كل عدد صحيح عدد ZELD المراد إرسالها إلى UTXO المخرج المقابل

=== قواعد التوزيع:

- يتم تعديل عدد القيم في مصفوفة التوزيع تلقائيًا لتتوافق مع عدد المخرجات غير OP_RETURN

- إذا كانت المصفوفة طويلة جدًا، تتم إزالة القيم الإضافية

- إذا كانت المصفوفة قصيرة جدًا، تتم إضافة أصفار

- لا يمكن أن يتجاوز مجموع قيم التوزيع إجمالي ZELD التي يتم إنفاقها

- إذا كان المجموع أقل من الإجمالي، تتم إضافة الفرق إلى المخرج الأول

- إذا تجاوز المجموع الإجمالي، تعود المعاملة إلى التوزيع النسبي

- يتم دائمًا توزيع مكافآت ZELD المعدنة حديثًا بشكل نسبي ثم يتم دمجها مع التوزيع المخصص

=== مثال:

إذا كان لديك 1000 ZELD لتوزيعها على 3 مخرجات وتريد إرسال 600 إلى الأول و 300 إلى الثاني و 100 إلى الثالث، فسيحتوي OP_RETURN الخاص بك على "ZELD" متبوعًا بترميز CBOR لـ [600, 300, 100].

*ملاحظات:*
- إذا لم يتم العثور على توزيع OP_RETURN صالح، تستخدم المعاملة تلقائيًا طريقة التوزيع النسبي.
- إذا كانت المعاملة تحتوي فقط على مخرج OP_RETURN واحد، فإن أي ZELD مرفقة بمدخلات المعاملة #strong[وأي مكافآت مكتسبة حديثًا] يتم حرقها بشكل دائم لأنه لا توجد مخرجات قابلة للإنفاق لاستلامها.
- عند وجود عدة مخرجات OP_RETURN، يتم النظر فقط في المخرج الذي يظهر أخيرًا في المعاملة والذي يحمل حمولة `ZELD`+CBOR صالحة للتوزيع.

