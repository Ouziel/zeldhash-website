#set document(
  title: "ZELDHASHプロトコル",
  author: "Ouziel Slama"
)
#set page(
  paper: "a4",
  margin: (x: 2.5cm, y: 2.5cm),
  numbering: "1",
)
#set par(justify: true, leading: 0.65em)
#set heading(numbering: "1.1")
#show heading: it => [
  #it
  #v(0.8em)
]

#align(center)[
  #text(size: 24pt, weight: "bold")[ZELDHASHプロトコル]
]
#align(center)[
  #text(size: 14pt)[*ビットコインの最も希少なトランザクションを狩り、ZELDを獲得しよう。*]
]
#align(center)[
  #text(size: 12pt)[著者：Ouziel Slama]
]

#v(2em)

= 動機

- 狩りのスリルのために。すべてのトランザクションが希少なものを発見する機会となります — ブロックチェーン上で目に見える場所に隠されたデジタルの宝物です。

- これらの先頭ゼロのパターンは単に希少なだけでなく — 圧縮を強化し、ブロックチェーンのストレージと処理効率を合理化する可能性があります。

- 誰でも希少なトランザクションを狩ることでZELDを獲得できます — ビットコインブロックマイニングのようにブロックごとに単一の勝者ではありません。狩りはすべての人に開かれています。

- 成功すれば、ZELDトークンは最終的にトランザクション手数料を払い戻すことができます — 最も希少な発見をしたハンターに報酬を与えます！

= ZELDマイニング

ZELDをマイニングするには、txidが少なくとも6つのゼロで始まるビットコイントランザクションをブロードキャストする必要があります。報酬は、あなたのトランザクションがブロック内の最良のトランザクションとどのように比較されるかに基づいて計算されます：

- 特定のブロックでは、最も多くのゼロで始まるトランザクションが4096 ZELDを獲得します

- 最良のトランザクションより1つゼロが少ないトランザクションは4096/16または256 ZELDを獲得します

- 2つゼロが少ないトランザクションは4096 / 16 / 16または16 ZELDを獲得します

- など。

したがって、使用される式は次のとおりです：

#align(center)[
  ```
  reward = 4096 / 16 ^ (max_zero_count - zero_count)
  ```
]

ここで`max_zero_count`は最良のトランザクションを開始するゼロの数に等しく、`zero_count`は報酬を計算するトランザクションを開始するゼロの数です。

*注：* コインベーストランザクションはZELD報酬の対象外です。

= ZELD配分

6つ以上のゼロで始まるトランザクションで獲得したZELDはUTXOに配分されます。配分は次のように行われます：

- 単一の非OP_RETURN UTXOがある場合、報酬全体を受け取ります。

- 2つ以上の非OP_RETURN UTXOがある場合、報酬は最後のものを除くすべてのUTXOに各UTXOの値に比例して配分されます

- 計算は整数のみで行われるため、除算の余りは最初の非OP_RETURN UTXOに配分されます。

例えば、256 ZELDを獲得したトランザクションにそれぞれ500、500、500、2000サトシの4つの出力が含まれている場合、最初の出力は報酬の86 ZELDを受け取り、2番目と3番目は85 ZELDを受け取ります。

= ZELDの移動

添付されたZELDを持つUTXOが使用されると、ZELDはトランザクション内の新しいUTXOに配分されます。ZELDを移動する際に配分する2つの方法があります：

== 方法1：自動比例配分

デフォルトでは、配分は報酬とまったく同じ方法で行われます — 出力UTXOのビットコイン値に基づいて比例的に、複数の出力がある場合は最後の出力を除きます。

== 方法2：OP_RETURNによるカスタム配分

カスタム配分データを含むOP_RETURN出力をトランザクションに含めることで、ZELDがどのように配分されるべきかを正確に指定できます。これにより、ZELD転送を正確に制御できます。

=== OP_RETURNフォーマット：

- OP_RETURNスクリプトには4バイトプレフィックス「ZELD」で始まるデータが含まれている必要があります

- プレフィックスの後、データはCBOR形式でエンコードされている必要があります

- CBORデータは符号なし64ビット整数のベクトル（Vec<u64>）を表す必要があります

- 各整数は対応する出力UTXOに送信するZELDの数を指定します

=== 配分ルール：

- 配分配列の値の数は非OP_RETURN出力の数に一致するように自動的に調整されます

- 配列が長すぎる場合、余分な値は削除されます

- 配列が短すぎる場合、ゼロが追加されます

- 配分値の合計は使用されているZELDの合計を超えることはできません

- 合計が総計より少ない場合、差額は最初の出力に追加されます

- 合計が総計を超える場合、トランザクションは比例配分に戻ります

- 新しくマイニングされたZELD報酬は常に比例的に配分され、その後カスタム配分と組み合わされます

=== 例：

3つの出力に1000 ZELDを配分し、最初に600、2番目に300、3番目に100を送りたい場合、OP_RETURNには「ZELD」の後に[600, 300, 100]のCBORエンコーディングが含まれます。

*注：*
- 有効なOP_RETURN配分が見つからない場合、トランザクションは自動的に比例配分方法を使用します。
- トランザクションにOP_RETURN出力が1つだけ含まれている場合、トランザクションの入力に添付されたZELD #strong[および新しく獲得した報酬]は、受け取るための使用可能な出力がないため、永久に焼却されます。
- 複数のOP_RETURN出力がある場合、トランザクションで最後に表示され、有効な`ZELD`+CBORペイロードを持つものだけが配分に考慮されます。

